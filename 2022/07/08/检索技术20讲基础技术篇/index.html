

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="ryan">
  <meta name="keywords" content="">
  <meta name="description" content="极客时间 检索技术20讲 学习文档   何为检索一句话概括检索技术：它是更底层的通用技术，它研究的是如何将我们所需要的数据高效地取出来  检索相关知识全景图  基础知识1.线性结构检索基本概念 数组和链表分别代表了连续空间和不连续空间的最基础的存储方式，它们是线性表（Linear List）的典型代表。其他所有的数据结构，比如栈、队列、二叉树、B+ 树等，都不外乎是这两者的结合和变化。以栈为例，">
<meta property="og:type" content="article">
<meta property="og:title" content="检索技术20讲 基础技术篇">
<meta property="og:url" content="http://example.com/2022/07/08/%E6%A3%80%E7%B4%A2%E6%8A%80%E6%9C%AF20%E8%AE%B2%E5%9F%BA%E7%A1%80%E6%8A%80%E6%9C%AF%E7%AF%87/index.html">
<meta property="og:site_name" content="ryan‘s space">
<meta property="og:description" content="极客时间 检索技术20讲 学习文档   何为检索一句话概括检索技术：它是更底层的通用技术，它研究的是如何将我们所需要的数据高效地取出来  检索相关知识全景图  基础知识1.线性结构检索基本概念 数组和链表分别代表了连续空间和不连续空间的最基础的存储方式，它们是线性表（Linear List）的典型代表。其他所有的数据结构，比如栈、队列、二叉树、B+ 树等，都不外乎是这两者的结合和变化。以栈为例，">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329417.jpg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329615.jpeg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329406.jpeg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329163.jpeg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329209.jpeg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329975.jpeg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329355.jpeg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329621.jpeg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329702.jpg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329548.jpg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329994.jpg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082330783.jpg">
<meta property="og:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082330214.jpg">
<meta property="article:published_time" content="2022-07-08T12:09:15.000Z">
<meta property="article:modified_time" content="2022-07-08T15:42:34.170Z">
<meta property="article:author" content="ryan">
<meta property="article:tag" content="搜索">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329417.jpg">
  
  <title>检索技术20讲 基础技术篇 - ryan‘s space</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/atom-one-dark-reasonable.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"38d9989ef01991aacdb7c2ab68c48482","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 60vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ryan&#39;s space</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082336212.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="检索技术20讲 基础技术篇">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-07-08 20:09" pubdate>
        July 8, 2022 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.4k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      17 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">检索技术20讲 基础技术篇</h1>
            
            <div class="markdown-body">
              <blockquote>
<p>极客时间 检索技术20讲 学习文档 </p>
</blockquote>
<h2 id="何为检索"><a href="#何为检索" class="headerlink" title="何为检索"></a>何为检索</h2><p>一句话概括检索技术：它是更底层的通用技术，它研究的是如何将我们所需要的数据高效地取出来 </p>
<p>检索相关知识全景图</p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329417.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="1-线性结构检索"><a href="#1-线性结构检索" class="headerlink" title="1.线性结构检索"></a>1.线性结构检索</h3><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329615.jpeg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>数组和链表分别代表了连续空间和不连续空间的最基础的存储方式，它们是线性表（Linear List）的典型代表。其他所有的数据结构，比如栈、队列、二叉树、B+ 树等，都不外乎是这两者的结合和变化。以栈为例，它本质就是一个限制了读写位置的数组，特点是只允许后进先出。</p>
<h5 id="如何检索"><a href="#如何检索" class="headerlink" title="如何检索"></a>如何检索</h5><p>如果数据是无序存储的话，无论是数组还是链表，想要查找一个指定元素是否存在，在缺乏数据分布信息的情况下，我们只能从头到尾遍历一遍，才能知道其是否存在。这样的检索效率就是 O(n)。</p>
<p>如果数据量较大，O(n)的检索效率肯定是不合格的，所以我们需要更高效的检索方式。</p>
<p>对于规模较大的数据集，我们往往是先将它通过排序算法转为有序的数据集，然后通过一些检索算法，比如二分查找算法来完成高效的检索。</p>
<p>二分查找也叫折半查找，它的思路很直观，就是将有序数组二分为左右两个部分，通过只在半边进行查找来提升检索效率。整体的平均查询效率就是 O(log n)，远远小于遍历整个数组的代价 O(n)。 </p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329406.jpeg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>检索的核心思路，其实就是通过合理组织数据，尽可能地快速减少查询范围，提高检索效率</p>
<h4 id="链表的优缺点"><a href="#链表的优缺点" class="headerlink" title="链表的优缺点"></a>链表的优缺点</h4><p>二分查找可以很大的提高有序数组的查找效率，这与数组的随机访问特性有关，通过下标，我们可以很轻易的访问到中间的元素，这是数组的 ‘连续空间存储’ 带来的优点</p>
<p>链表并不具备 随机访问 的特点， 如果我们想要访问链表的中间元素， 需要遍历链表到中间节点， 时间代价就是O(n/2)，所以，由于缺少了 随机访问 的特性， 链表的检索能力是偏弱的</p>
<p>凡事都有两面性，链表的 非连续空间存储 的特性给它带来了动态调整上的优势</p>
<p>想象一下，如果我们需要在有序数组中插入一个元素，为保证数组的有序，我们需要将数组中大于这个元素的所有其他元素后移一位，这其实是一个O(n)的时间代价了 ，而对于链表来说，插入和删除只需要调整前后节点的指针即可， 时间代价为O(1)</p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329163.jpeg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="如何改造链表"><a href="#如何改造链表" class="headerlink" title="如何改造链表"></a>如何改造链表</h4><p>本质上，我们学习链表，就是在学习“非连续存储空间”的组织方案， 我们知道，对于“非连续空间”，可以用指针将它串联成一个整体。只要掌握了这个思想，我们就可以在不同的应用场景中，设计出适用的数据结构，而不需要拘泥于链表自身的结构限制。 </p>
<p>一个例子：</p>
<p>如果我们让链表的每个节点不再只存储一个元素，而是存储一个有序数组， 这样可以大幅减少节点数量， 从而减少遍历节点带来的 低寻址效率 。</p>
<h4 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h4><p>1.对于有序数组的高效检索，为何使用二分检索， 而不是三七分 或 四六分？</p>
<p>2.在一个有序数组中，给出两个目标值 x 和 y ， 希望找出目标值之间的所有元素， 应该怎么做？ </p>
<ol>
<li>因为二分可以确保概率均匀，左右都是1/2 , 最差时间复杂度就是O(log n), 而三七或四六无法保证左右概率均匀， 拿三七举例，假设有序数组一共有100个元素 ， 如果每次都要在右边进行查找，一共需要检索13次， 复杂度为O(log n) 底数大概是1.425 （100 ^ (1/13) 估算）， 二分最多只需检索7次   </li>
<li>两次二分确定下标，两下标区间内的元素就是需要检索的元素 </li>
</ol>
<h3 id="2-非线性结构检索"><a href="#2-非线性结构检索" class="headerlink" title="2.非线性结构检索"></a>2.非线性结构检索</h3><p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329209.jpeg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="树结构进行如何二分查找"><a href="#树结构进行如何二分查找" class="headerlink" title="树结构进行如何二分查找"></a>树结构进行如何二分查找</h4><p>由于链表不具备 随机访问 的特性，无法以O(1)的时间代价访问中间节点，  所以无法使用二分查找 ， 那么如果我们对链表进行一些改造， 让它可以直接访问中间节点， 是不是就能使用二分查找了呢？ </p>
<p>首先将链表的中间节点拎出来单独记录，称之为M节点， 这样我们就可以直接访问它了， 然后判断这个节点存储的元素和需要检索的元素是否一致， 如果 一致，则返回结果即可； 如果节点元素大于检索元素，则到左边继续查找， 反之则到右边查找；</p>
<p>对于左右两边的节点，将其视为两个独立的子链表， 逻辑和M节点一样， 单独存储左右两个节点。 因为左右两个节点都可能被从M节点访问 ， 我们需要让M节点带两个指针， 左指针指向左边的子链表， 右指针指向右边的子链表 </p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329975.jpeg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>然后我们对其他节点进行一样的操作，结构就会变成 </p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329355.jpeg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>这就是我们常见的二叉树</p>
<p>如果我们保证了链表的有序性， 那么这颗二叉树就是有序的， 左子树的所有节点值都小于根节点， 右子树的所有节点都大于根节点； 这样的有序结构，使它能够使用二分查找，快速地过滤掉一半的数据， 具备这样特点的二叉树，就是二叉检索树，又称二叉排序树 </p>
<p>尽管有序数组和二叉检索树，在数据结构形态上看起来差异很大，但是在提高检索效率上，它们的核心原理都是一致的</p>
<ul>
<li>将数据有序化，并且根据数据存储的特点进行不同的组织。对于连续存储空间的数组而言，由于它具有“随机访问”的特性，因此直接存储即可；对于非连续存储空间的有序链表而言，由于它不具备“随机访问”的特性，因此，需要将它改造为可以快速访问到中间节点的树状结构。</li>
<li>在进行检索的时候，它们都是通过二分查找的思想从中间节点开始查起。如果不命中，会快速缩小一半的查询空间。这样不停迭代的查询方式，让检索的时间代价能达到 O(log n) 这个级别。</li>
</ul>
<h4 id="二叉检索树的检索空间平衡方案"><a href="#二叉检索树的检索空间平衡方案" class="headerlink" title="二叉检索树的检索空间平衡方案"></a>二叉检索树的检索空间平衡方案</h4><p>如果一颗二叉检索树的每一个节点的左指针（或右指针）都是空的， 那么它会退化为一个单链表， 检索效率退化为O(n) </p>
<img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329621.jpeg" srcset="/img/loading.gif" lazyload alt="img" style="zoom: 50%;" />

<p>出现这种情况的最根本原因是检索空间不平衡，在当前节点不满足查询条件的时候，它无法把“一半的数据”过滤掉，而是只能过滤掉当前检索的这个节点。因此无法达到“快速减小查询范围”的目的。</p>
<p>因此，为了确保二叉查询树的检索效率，需要尽可能的平衡左右子树； 为了解决这个问题， 有更多的数据结构被发明出来， 比如AVL树（平衡二叉树）和红黑树；它们本质上都是二叉检索树，但它们都在保证左右子树差距不要太大上做了特殊的处理，保证了检索效率</p>
<h4 id="跳表"><a href="#跳表" class="headerlink" title="跳表"></a>跳表</h4><p>二叉检索树是一种为了实现快速访问中间节点的对链表的改造方案， 还有另一种实现了相同功能的改造方案，称之为 跳表 （skip list）； </p>
<p>链表之所以访问中间节点的效率低，就是因为每个节点只存储了下一个节点的指针，要沿着这个指针遍历每个后续节点才能到达中间节点；如果我们在每个节点上增加一个指针，指向更远的节点，那么沿着这个指针遍历，就可以实现遍历速度的翻倍。</p>
<p>同理，我们可以为节点增加更多的指针，这些指针指向不同距离的后续节点，这样一来，链表就具备了更高效的检索能力；</p>
<p>一个理想的跳表，就是从头节点开始，用多个不同的步长，每隔2^n个节点做一次直接链接（n 取值为 0，1，2……），跳表中的每个节点都拥有多个不同步长的指针，我们可以在每个节点中使用一个数组next来记录这些指针，数组的长度等于指针的层数，比如next[0] 就是第一层步长为1的指针， next[1] 就是第二层步长为2的指针， next[2] 就是第三层步长为4的指针。</p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329702.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>假设检索目标为a6， 第一步用最大步长遍历至a5， 因为a6 大于a5， 继续遍历至a9, a6小于a9，说明a6在a5和a9之间， 接着从a5开始，使用小一级别的步长遍历至a7, 同理，可以知道a6在a5和a7之间， 继续从a5开始，使用小一级别的步长遍历，检索到a6，检索完毕， 整个过程的时间复杂度为O(log n)；</p>
<h4 id="跳表的检索空间平衡方案"><a href="#跳表的检索空间平衡方案" class="headerlink" title="跳表的检索空间平衡方案"></a>跳表的检索空间平衡方案</h4><p>实际情况中，  如果我们需要在跳表中插入节点，那么原有节点之间的距离就会被改变，如果要保证每个2^n个节点做一次链接的特性， 那么需要修改许多后续节点的指针，这会带来非常大的开销。</p>
<p>所以，我们需要在检索性能与修改指针的代价之间做一个权衡； 实际情况中，我们不需要保证链表是一个理想的平衡状态， 只需要保证它在大概率上是平衡的就可以了。</p>
<p>具体操作是这样， 首先通过随机函数（譬如 (1/2)^n ）来确认新增节点的指针层数，然后将新增节点和前后的节点连接起来，为每一层的指针建立前后连接关系，如下图 </p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329548.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>因为新节点的指针层数是随机生成的，当链表节点较少的情况下，指针分布可能会比较不合理，这也会导致检索新能不理想； 但当节点数较多时，指针会趋向均匀分布，查找空间会比较平衡，检索性能趋向于理想跳表，接近O(log n)</p>
<h4 id="思考题-1"><a href="#思考题-1" class="headerlink" title="思考题"></a>思考题</h4><p>二叉检索树和跳表都能做到 O(log n)  的查询时间代价，还拥有灵活的调整能力，并且调整代价也是 O(log n)（包括了寻找插入位置的时间代价）。而有序数组的查询时间代价也是  O(log n)，调整代价是 O(n)，那这是不是意味着二叉检索树或者跳表可以用来替代有序数组呢？有序数组自己的优势又是什么呢？</p>
<p>有序数组 使用的是一段连续的内存可以支持随机访问，而且由于使用的是连续的内存的 可以高效使用 CPU 的局部性原理，可以缓存要访问数据之后的数据，进而范围查询更高效</p>
<h3 id="3-哈希检索"><a href="#3-哈希检索" class="headerlink" title="3.哈希检索"></a>3.哈希检索</h3><p>不管是有序数组、二叉检索树还是跳表，它们的检索效率都是O(log n)，如果想要实现O(1)效率的检索，就需要用到哈希检索了。</p>
<h4 id="hash函数"><a href="#hash函数" class="headerlink" title="hash函数"></a>hash函数</h4><p>将对象转为有限范围的正整数的表示方法，就叫作  Hash，翻译过来叫散列，也可以直接音译为哈希。而我们常说的 Hash 函数就是指具体转换方法的函数。我们将对象进行 Hash，用得到的  Hash 值作为数组下标，将对应元素存在数组中。这个数组就叫作哈希表。这样我们就可以利用数组的随机访问特性，达到 O(1) 级别的查询性能。</p>
<p>hash函数特点决定了它不可避免会出现hash冲突，对于冲突，通常有两种解决方案</p>
<ul>
<li> 构造尽可能理想的哈希函数，使得hash以后得到的数据尽可能平均分布，从而减少冲突发生的概率</li>
<li>在冲突发生之后，通过一些解决方案来完成存储和查找，最常用的两种解决方案是 开放寻址法 和 链表法</li>
</ul>
<h4 id="开放寻址法"><a href="#开放寻址法" class="headerlink" title="开放寻址法"></a>开放寻址法</h4><p>开放寻址法， 就是在冲突发生以后，待插入的元素需要寻找新空闲的数组位置完成插入，我们可以使用一种叫做 线性探查（Linear Probing） 的方案来寻找新的空闲位置  </p>
<p>线性探查的插入逻辑很简单， 就是按顺序寻找当前冲突数组位的下一个位置， 检查是否空闲， 空闲就插入， 否则就继续往后找。</p>
<p>查询逻辑与插入逻辑一致， 先根据hash值找到指定的数组位， 如果当前数组位不为空，比较 key是否一致，不一致就按顺序往下继续检索，如果遍历完后仍没有匹配的对象，则代表目标对象不在当前数组中。</p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082329994.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>在哈希表已经比较满的情况下，线性探查的查询和插入效率都会接近O(n)，并且更糟糕的是，线性探查会影响其他key的插入和查询效率， 线性探查会影响哈希表的整体性能，而不只是hash冲突的key</p>
<p>对于这个问题， 可以使用 二次探查 和 双散列 来优化 </p>
<p>二次探查就是将线性探查的步长从 i 改为 i^2 （ i 为 1，2，3，4…. )</p>
<p>双散列就是使用多个hash函数计算， 如果第一个hash值冲突了，启用第二个hash函数计算， 如果继续冲突， 继续启用第三个hash函数计算 ，以此类推 。</p>
<p>无论是二次探查还是双散列，其实都是治标不治本， 开放寻址法因为它本身的特性， 无论使用何种方案去处理哈希冲突，都会不可避免的影响哈希表整体的性能， 哈希表越满，性能下降得越厉害，到最后无限趋近于 O(n)，这时候就需要Re-Hash ， 就是创建一个新的，更大的哈希表，将老哈希表得数据进行迁移， 这无疑会带来巨大的额外开销。 因此，在数据动态变化得场景下， 开放寻址法并不是一个好的解决方案。</p>
<h4 id="链表法"><a href="#链表法" class="headerlink" title="链表法"></a>链表法</h4><p>所谓“链表法”，就是在数组中不存储一个具体元素，而是存储一个链表头。如果一个 Key 经过 Hash 函数计算，得到了对应的数组下标，那么我们就将它加入该位置所存的链表的尾部。</p>
<p>这样做的好处是，如果 key3 和 key1 发生了冲突，那么 key3 会通过链表的方式链接在 key1 的后面，而不是去占据 key2 的位置。这样当 key2 插入时，就不会有冲突了。最终效果如下图。</p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082330783.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>链表法就是将数组和链表进行结合，既利用了数组的随机访问特性，又利用了链表的动态修改特性，同时提供了快速查询和动态修改的能力。</p>
<p>如果链表很长，遍历代价还是会很高，解决方案就是对链表进行改造， 改造方法在上一篇的非线性结构检索中已经提及，两种思路 ， 1.改造为二叉检索树 。 2.改造为跳表 。 检索这样的哈希表的平均时间复杂度为                O(1) + O(log n)， 如果哈希冲突比较少，那么落到链表或红黑树中的元素不会太多， 检索代价基本可以视为常数级别。</p>
<p>在 JDK1.8 之后，Java 中 HashMap 的实现就是在链表到了一定的长度时，将它转为红黑树；而当红黑树中的节点低于一定阈值时，就将它退化为链表。</p>
<p><img src="https://ryansimg.oss-cn-shanghai.aliyuncs.com/2021/202207082330214.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="哈希表的缺点"><a href="#哈希表的缺点" class="headerlink" title="哈希表的缺点"></a>哈希表的缺点</h4><p>哈希表接近 O(1) 的检索效率是有前提条件的，就是哈希表要足够大和有足够的空闲位置，否则就会非常容易发生冲突。我们一般用装载因子（load factor）来表示哈希表的填充率。装载因子 = 哈希表中元素个数 / 哈希表的长度。</p>
<p>如果频繁发生冲突，大部分的数据会被持续地添加到链表或二叉检索树中，检索也会发生在链表或者二叉检索树中，这样检索效率就会退化。因此，为了保证哈希表的检索效率，我们需要预估哈希表中的数据量，提前生成足够大的哈希表。按经验来说，我们一般要预留一半以上的空闲位置，哈希表才会有足够优秀的检索效率。这就让哈希表和有序数组、二叉检索树相比，需要的存储空间更多了。</p>
<p>哈希表无法进行范围检索，需要遍历所有元素。</p>
<h4 id="思考题-2"><a href="#思考题-2" class="headerlink" title="思考题"></a>思考题</h4><p>假设一个哈希表是使用开放寻址法实现的，如果我们需要删除其中一个元素，可以直接删除吗？为什么呢？如果这个哈希表是使用链表法实现的会有不同吗？</p>
<p>不能，开放寻址法在hash冲突后，会将元素往后放，如果已经存在几个hash冲突的元素， 删除其中一个，会影响对后面元素的检索， 可以对要删除的元素加一个删除标签。</p>
<p>如果是链表法的话直接删除即可，链表的删除时间代价为O(1)</p>
<h3 id="4-状态检索"><a href="#4-状态检索" class="headerlink" title="4.状态检索"></a>4.状态检索</h3><h3 id="5-倒排索引"><a href="#5-倒排索引" class="headerlink" title="5.倒排索引"></a>5.倒排索引</h3><h4 id="5-1-倒排索引加速（一）"><a href="#5-1-倒排索引加速（一）" class="headerlink" title="5.1 倒排索引加速（一）"></a>5.1 倒排索引加速（一）</h4><h4 id="5-2-倒排索引加速（二）"><a href="#5-2-倒排索引加速（二）" class="headerlink" title="5.2 倒排索引加速（二）"></a>5.2 倒排索引加速（二）</h4>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E6%90%9C%E7%B4%A2/">搜索</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/29/rabbitmq%20delay%20queue/">
                        <span class="hidden-mobile">rabbitmq delay queue</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"fNUxhX4VOsT8Dnz93C30c1YE-gzGzoHsz","appKey":"QixxRhAsofecCW4rrHDfyTtP","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","recordIP":true,"serverURLs":"https://fnuxhx4v.lc-cn-n1-shared.com","emojiCDN":"//i0.hdslb.com/bfs/emote/","emojiMaps":{"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png","tv_打脸":"56ab10b624063e966bfcb76ea5dc4794d87dfd47.png","tv_抓狂":"fe31c08edad661d63762b04e17b8d5ae3c71a757.png","tv_抠鼻":"c666f55e88d471e51bbd9fab9bb308110824a6eb.png","tv_斜眼笑":"911f987aa8bc1bee12d52aafe62bc41ef4474e6c.png","tv_无奈":"ea8ed89ee9878f2fece2dda0ea8a5dbfe21b5751.png","tv_晕":"5443c22b4d07fb1907ccc610c8e6db254f2461b7.png","tv_流汗":"cead1c351ab8d79e9f369605beb90148db0fbed3.png","tv_流泪":"7e71cde7858f0cd50d74b0264aa26db612a8a167.png","tv_流鼻血":"c32d39db2737f89b904ca32700d140a9241b0767.png","tv_点赞":"f85c354995bd99e28fc76c869bfe42ba6438eff4.png","tv_生气":"26702dcafdab5e8225b43ffd23c94ac1ff932654.png","tv_生病":"8b0ec90e6b86771092a498c54f09fc94621c1900.png","tv_疑问":"0793d949b18d7be716078349c202c15ff166f314.png","tv_白眼":"c1d59f439e379ee50eef488bcb5e5378e5044ea4.png","tv_皱眉":"72ccad6679fea0d14cce648b4d818e09b8ffea2d.png","tv_目瞪口呆":"0b8cb81a68de5d5365212c99375e7ace3e7891b7.png","tv_睡着":"8b196675b53af58264f383c50ad0945048290b33.png","tv_笑哭":"1abc628f6d4f4caf9d0e7800878f4697abbc8273.png","tv_腼腆":"89712c0d4af73e67f89e35cbc518420380a7f6f4.png","tv_色":"61822c7e9aae5da76475e7892534545336b23a6f.png","tv_调侃":"4bc022533ef31544ca0d72c12c808cf4a1cce3e3.png","tv_调皮":"b9c41de8e82dd7a8515ae5e3cb63e898bf245186.png","tv_鄙视":"6e72339f346a692a495b123174b49e4e8e781303.png","tv_闭嘴":"c9e990da7f6e93975e25fd8b70e2e290aa4086ef.png","tv_难过":"87f46748d3f142ebc6586ff58860d0e2fc8263ba.png","tv_馋":"fc7e829b845c43c623c8b490ee3602b7f0e76a31.png","tv_鬼脸":"0ffbbddf8a94d124ca2f54b360bbc04feb6bbfea.png","tv_黑人问号":"45821a01f51bc867da9edbaa2e070410819a95b2.png","tv_鼓掌":"1d21793f96ef4e6f48b23e53e3b9e42da833a0f6.png"},"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        
      </a>
    </span>
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?38d9989ef01991aacdb7c2ab68c48482";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
